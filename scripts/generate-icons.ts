#!/usr/bin/env node
import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

// ESM ëª¨ë“ˆì—ì„œ __dirname í‰ë‚´ ë‚´ê¸°
const __dirname = path.dirname(fileURLToPath(import.meta.url));

// í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê¸°ì¤€ src/... ìœ¼ë¡œ ê²½ë¡œ ì„¤ì •
const ICONS_DIR = path.resolve(__dirname, '../src/stories/components/Atoms/UIIcon/icons');
const OUTPUT_FILE = path.join(ICONS_DIR, 'icons.ts');

console.log(`ğŸ”§ Looking for SVGs in: ${ICONS_DIR}`);

// icons ë””ë ‰í„°ë¦¬ ì¡´ì¬ í™•ì¸
if (!fs.existsSync(ICONS_DIR)) {
  console.error(`âŒ icons í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${ICONS_DIR}`);
  process.exit(1);
}

// .svg íŒŒì¼ë§Œ í•„í„°
const files = fs.readdirSync(ICONS_DIR).filter(f => f.endsWith('.svg'));

if (files.length === 0) {
  console.warn(`âš ï¸ í•´ë‹¹ í´ë”ì— .svg íŒŒì¼ì´ í•˜ë‚˜ë„ ì—†ìŠµë‹ˆë‹¤.`);
}

// import êµ¬ë¬¸ê³¼ ë§¤í•‘ ë§Œë“¤ê¸°
const imports: string[] = [];
const mappings: string[] = [];

for (const file of files) {
  const base = path.basename(file, '.svg');
  const component = `${capitalize(base)}Icon`;
  imports.push(`import ${component} from './${file}';`);
  mappings.push(`  '${base}': ${component},`);
}

// ìµœì¢… ì¶œë ¥í•  content
const content = `/* THIS FILE IS AUTO-GENERATED by generate-icons.ts */
${imports.join('\n')}

export const iconsMap = {
${mappings.join('\n')}
} as const;

export type IconName = keyof typeof iconsMap;
export type IconComponent = (typeof iconsMap)[IconName];
`;

// ì“°ê¸°
try {
  fs.writeFileSync(OUTPUT_FILE, content, 'utf-8');
  console.log(`âœ… icons.ts ìƒì„± ì™„ë£Œ: ${OUTPUT_FILE} (${files.length}ê°œ ì•„ì´ì½˜)`);
} catch (err) {
  console.error(`âŒ íŒŒì¼ ì“°ê¸° ì‹¤íŒ¨: ${(err as Error).message}`);
  process.exit(1);
}

// ìœ í‹¸
function capitalize(str: string) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}
